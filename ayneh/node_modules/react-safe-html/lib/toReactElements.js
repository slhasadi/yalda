'use strict';

var React = require('react');

module.exports = function toReactElements(node, components) {
  var key = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'default_key';

  if (typeof node === 'string') {
    if (components['#text']) {
      var result = components['#text'](node);
      if (!result || !result.type) {
        console.error('react-safe-html #text component didn\'t return a react element');
        return node;
      }
      return result;
    } else {
      return node;
    }
  }

  var children = node.children;

  if (Array.isArray(children)) {
    children = node.children.map(function (child, i) {
      var element = toReactElements(child, components, i);
      return element;
    });
  }

  if (!Array.isArray(children)) {
    children = [children];
  }

  var resNode = null;
  var type = components[node.type];

  if (type) {
    var props = Object.assign({}, node.props, { key: key });
    resNode = React.createElement(type, props, children);
  } else {
    resNode = React.createElement('span', { key: key }, children);
  }
  return resNode;
};